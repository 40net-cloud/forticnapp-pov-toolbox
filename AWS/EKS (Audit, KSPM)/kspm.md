



| **KSPM Components**         | **Purpose / Function**                                                                                         | **Deployment Method**                                                 | **Privileges / Network Access**                                                                              | **Collection Frequency**        | **Data Sent to FortiCNAPP**             | **Key Requirements / Notes**                                                                                |
| --------------------- | -------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------ | ------------------------------- | --------------------------------------- | ----------------------------------------------------------------------------------------------------------- |
| **Cloud Collector**   | Enumerates and assesses EKS clusters using existing **CSPM (Cloud Configuration Integration)** for compliance. | Automatically available once AWS Configuration Integration is set up. | Runs as part of the cloud integration (no pod deployment required).                                          | Daily (based on CSPM schedule). | Within 24 hours of configuration setup. | Requires AWS  Configuration Integration. No additional setup for EKS.                                 |
| **Node Collector**    | Collects **node-level data** (configurations, workloads, metadata) from each node in the EKS cluster.          | **Helm or Terraform** (not DaemonSet).                                | Runs as a **privileged pod** using the **host network namespace**.                                           | Every hour.                     | Within 2 hours of installation.         | Requires access to the **Instance Metadata Service (IMDS)**. Must be deployed on each cluster.              |
| **Cluster Collector** | Collects **cluster-wide configuration and API data** (RBAC, resources, policies).                              | **Helm or Terraform**                                                 | Runs as a **non-privileged pod** using the **pod network namespace** (can use host network if IMDS blocked). | Every 24 hours.                 | Within 2 hours of installation.         | Requires access to both the **Kubernetes API Server** and **IMDS**. If IMDS blocked ‚Üí *Partial Collection*. |  

------
------

| **Notes**           | **Description**                                                                                                                                                                                                                                                                                                                                                                                               |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Full Collection**    | All three collectors (**Cloud**, **Node**, **Cluster**) are installed and actively sending data ‚Äî complete Kubernetes compliance visibility.                                                                                                                                                                                                                                                                  |
| **Partial Collection** | One or more collectors (usually Node or Cluster) are missing or misconfigured ‚Äî limited compliance visibility in FortiCNAPP.                                                                                                                                                                                                                                                                                  |
| **No Collection**      | Cloud Configuration Integration (CSPM) not set up ‚Äî FortiCNAPP cannot detect or enumerate EKS clusters.                                                                                                                                                                                                                                                                                                       |
| **Common Issue**       | ‚ö†Ô∏è **Error Message:** `Partial collection available. The node collector has not been configured.`<br><br>**Cause:** This occurs when the `lacework-agent-cluster` pod cannot reach the **AWS Instance Metadata Service (IMDS)**.<br><br>**Resolution:** Ensure IMDS access is allowed from pods. Verify that network policies, service meshes, or firewalls are not blocking access to the metadata endpoint. |  

-----

| **Issue / Message**                                                                | **Possible Cause**                                                                                   | **Verification Command**                                                                                                                                                                                                                         | **Resolution / Fix**                                                                                                    |                                                                                                                                                                                                                          |   |             |   |                      |                                                                                                                                                                                                                                                                                                                                                         |
| ---------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | - | ----------- | - | -------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| üü† **‚ÄúPartial collection available. The node collector has not been configured.‚Äù** | The `lacework-agent-cluster` pod cannot reach the AWS **Instance Metadata Service (IMDS)** endpoint. | ```bash kubectl -n lacework exec deploy/lacework-agent-cluster -- sh -lc 'T=$(curl -s --connect-timeout 2 -X PUT [http://169.254.169.254/latest/api/token](http://169.254.169.254/latest/api/token) -H "X-aws-ec2-metadata-token-ttl-seconds:60" |                                                                                                                         | true); [ -n "$T" ] && { printf "instance_id: "; curl -s --connect-timeout 2 -H "X-aws-ec2-metadata-token: $T" [http://169.254.169.254/latest/meta-data/instance-id](http://169.254.169.254/latest/meta-data/instance-id) |   | echo ERR; } |   | echo TOKEN_FAIL' ``` | ‚úÖ If you see `instance_id: i-xxxxxxxxxxxx`, IMDS is accessible.<br>‚ö†Ô∏è If you see `TOKEN_FAIL` or `ERR`, IMDS is blocked.<br><br>**Fix:**<br>‚Ä¢ Check NetworkPolicies or CNIs blocking `169.254.169.254`.<br>‚Ä¢ Ensure node/pod can reach the IMDS endpoint.<br>‚Ä¢ If pod network cannot access IMDS, redeploy Cluster Collector using `hostNetwork: true`. |
| üü¢ **‚Äúid: cannot find name for user ID 5001‚Äù**                                     | This is a harmless container UID warning (no username mapped in `/etc/passwd`).                      | ‚Äî                                                                                                                                                                                                                                                | No action required ‚Äî IMDS test succeeded if instance ID appears.                                                        |                                                                                                                                                                                                                          |   |             |   |                      |                                                                                                                                                                                                                                                                                                                                                         |
| üî¥ **Node Collector missing in cluster**                                           | Node Collector not deployed or installed incorrectly (DaemonSet not created).                        | `bash kubectl -n lacework get ds -o wide `                                                                                                                                                                                                       | Redeploy via Helm or Terraform ensuring:<br>`kspm.nodeCollector.enabled=true` and `kspm.clusterCollector.enabled=true`. |                                                                                                                                                                                                                          |   |             |   |                      |                                                                                                                                                                                                                                                                                                                                                         |
| üü° **Partial Collection persists after redeploy**                                  | IMDS access intermittent or misconfigured in Helm values.                                            | `bash kubectl -n lacework logs deploy/lacework-agent-cluster --tail=100 `                                                                                                                                                                        | Confirm logs show IMDS connectivity success. If not, set `hostNetwork: true` for collectors and redeploy.               |                                                                                                                                                                                                                          |   |             |   |                      |                                                                                                                                                                                                                                                                                                                                                         |




