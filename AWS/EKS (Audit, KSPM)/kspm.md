



| **KSPM Components**         | **Purpose / Function**                                                                                         | **Deployment Method**                                                 | **Privileges / Network Access**                                                                              | **Collection Frequency**        | **Data Sent to FortiCNAPP**             | **Key Requirements / Notes**                                                                                |
| --------------------- | -------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------ | ------------------------------- | --------------------------------------- | ----------------------------------------------------------------------------------------------------------- |
| **Cloud Collector**   | Enumerates and assesses EKS clusters using existing **CSPM (Cloud Configuration Integration)** for compliance. | Automatically available once AWS Configuration Integration is set up. | Runs as part of the cloud integration (no pod deployment required).                                          | Daily (based on CSPM schedule). | Within 24 hours of configuration setup. | Requires AWS  Configuration Integration. No additional setup for EKS.                                 |
| **Node Collector**    | Collects **node-level data** (configurations, workloads, metadata) from each node in the EKS cluster.          | **Helm or Terraform** (not DaemonSet).                                | Runs as a **privileged pod** using the **host network namespace**.                                           | Every hour.                     | Within 2 hours of installation.         | Requires access to the **Instance Metadata Service (IMDS)**. Must be deployed on each cluster.              |
| **Cluster Collector** | Collects **cluster-wide configuration and API data** (RBAC, resources, policies).                              | **Helm or Terraform**                                                 | Runs as a **non-privileged pod** using the **pod network namespace** (can use host network if IMDS blocked). | Every 24 hours.                 | Within 2 hours of installation.         | Requires access to both the **Kubernetes API Server** and **IMDS**. If IMDS blocked → *Partial Collection*. |  

------
------

| **Notes**           | **Description**                                                                                                                                                                                                                                                                                                                                                                                               |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Full Collection**    | All three collectors (**Cloud**, **Node**, **Cluster**) are installed and actively sending data — complete Kubernetes compliance visibility.                                                                                                                                                                                                                                                                  |
| **Partial Collection** | One or more collectors (usually Node or Cluster) are missing or misconfigured — limited compliance visibility in FortiCNAPP.                                                                                                                                                                                                                                                                                  |
| **No Collection**      | Cloud Configuration Integration (CSPM) not set up — FortiCNAPP cannot detect or enumerate EKS clusters.                                                                                                                                                                                                                                                                                                       |
| **Common Issue**       | ⚠️ **Error Message:** `Partial collection available. The node collector has not been configured.`<br><br>**Cause:** This occurs when the `lacework-agent-cluster` pod cannot reach the **AWS Instance Metadata Service (IMDS)**.<br><br>**Resolution:** Ensure IMDS access is allowed from pods. Verify that network policies, service meshes, or firewalls are not blocking access to the metadata endpoint. |  

-----

| **Issue / Message**                                                           | **Cause**                                                                                                                                                                                                                                       | **Resolution**                                                                                                                                                                                                                                                                                              |   |                                                                                                                                                                                                                          |   |             |   |                                                                                                                                                                                                                                                                                                              |
| ----------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | - | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | - | ----------- | - | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Partial collection available. The node collector has not been configured.** | This message appears when the `lacework-agent-cluster` pod cannot access the AWS **Instance Metadata Service (IMDS)**. Without IMDS connectivity, the Node Collector cannot retrieve instance metadata and sends incomplete data to FortiCNAPP. | Run the following command to verify IMDS access:<br><br>```bash<br>kubectl -n lacework exec deploy/lacework-agent-cluster -- sh -lc 'T=$(curl -s --connect-timeout 2 -X PUT [http://169.254.169.254/latest/api/token](http://169.254.169.254/latest/api/token) -H "X-aws-ec2-metadata-token-ttl-seconds:60" |   | true); [ -n "$T" ] && { printf "instance_id: "; curl -s --connect-timeout 2 -H "X-aws-ec2-metadata-token: $T" [http://169.254.169.254/latest/meta-data/instance-id](http://169.254.169.254/latest/meta-data/instance-id) |   | echo ERR; } |   | echo TOKEN_FAIL'<br>```<br><br>If you get an output like `instance_id: i-xxxxxxxxxxxx`, IMDS access is working. If you see `TOKEN_FAIL` or `ERR`, IMDS is blocked. Ensure that network policies or CNIs are not restricting access to `169.254.169.254`, or redeploy the collector with `hostNetwork: true`. |
| **id: cannot find name for user ID 5001**                                     | A harmless message indicating the container runs as a user ID not mapped in `/etc/passwd`.                                                                                                                                                      | No action required — if the IMDS test succeeds, this warning can be ignored.                                                                                                                                                                                                                                |   |                                                                                                                                                                                                                          |   |             |   |                                                                                                                                                                                                                                                                                                              |
| **Node Collector not running**                                                | The Node Collector DaemonSet may not be deployed or is disabled in Helm values.                                                                                                                                                                 | Verify by running:<br>`kubectl -n lacework get ds -o wide`<br>If not present, redeploy with Helm ensuring `kspm.nodeCollector.enabled=true` and `kspm.clusterCollector.enabled=true`.                                                                                                                       |   |                                                                                                                                                                                                                          |   |             |   |                                                                                                                                                                                                                                                                                                              |
| **Partial Collection persists after redeployment**                            | IMDS connectivity is still restricted or network misconfiguration persists.                                                                                                                                                                     | Check logs using:<br>`kubectl -n lacework logs deploy/lacework-agent-cluster --tail=100`<br>If IMDS remains unreachable, enable `hostNetwork: true` in Helm values for both Node and Cluster Collectors, then redeploy.                                                                                     |   |                                                                                                                                                                                                                          |   |             |   |                                                                                                                                                                                                                                                                                                              |



